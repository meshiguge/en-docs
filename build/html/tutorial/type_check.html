

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Type check &mdash; Chainer 1.8.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/modified_theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Chainer 1.8.0 documentation" href="../index.html"/>
        <link rel="up" title="Chainer Tutorial" href="index.html"/>
        <link rel="next" title="Chainer Reference Manual" href="../reference/index.html"/>
        <link rel="prev" title="Define your own function" href="function.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> Chainer</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#before-installing-chainer">Before installing Chainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#install-chainer">Install Chainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#uninstall-chainer">Uninstall Chainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#upgrade-chainer">Upgrade Chainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#reinstall-chainer">Reinstall Chainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#run-chainer-with-docker">Run Chainer with Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#what-recommend-means">What &#8220;recommend&#8221; means?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#faq">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Chainer Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic.html">Introduction to Chainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="recurrentnet.html">Recurrent Nets and their Computational Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.html">Using GPU(s) in Chainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="function.html">Define your own function</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Type check</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Chainer Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/core.html">Core functionalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/util.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/check.html">Assertion and Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Standard Function implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/links.html">Standard Link implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optimizers.html">Optimizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/serializers.html">Serializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/function_hooks.html">Function hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/initializers.html">Weight Initializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/datasets.html">Dataset examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/iterators.html">Iterator examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/extensions.html">Trainer extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/triggers.html">Trainer triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/caffe.html">Caffe Reference Model Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/graph.html">Visualization of Computational Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/environment.html">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cupy-reference/index.html">CuPy Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/overview.html">CuPy Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/ndarray.html">Multi-Dimensional Array (ndarray)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/ufunc.html">Universal Functions (ufunc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/routines.html">Routines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/generic.html">NumPy-CuPy Generic Code Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/cuda.html">Low-Level CUDA Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/memoize.html">Kernel binary memoization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/kernel.html">User-Defined Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/testing.html">Testing Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/environment.html">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cupy-reference/difference.html">Difference between CuPy and NumPy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Chainer Contribution Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribution.html#classification-of-contributions">Classification of Contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribution.html#release-and-milestone">Release and Milestone</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribution.html#issues-and-prs">Issues and PRs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribution.html#coding-guidelines">Coding Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribution.html#testing-guidelines">Testing Guidelines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../compatibility.html">API Compatibility Policy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../compatibility.html#targeted-versions">Targeted Versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compatibility.html#versioning-and-backward-compatibilities">Versioning and Backward Compatibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compatibility.html#processes-to-break-backward-compatibilities">Processes to Break Backward Compatibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compatibility.html#experimental-apis">Experimental APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compatibility.html#supported-backward-compatibility">Supported Backward Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compatibility.html#model-format-compatibility">Model Format Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compatibility.html#installation-compatibility">Installation Compatibility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and FAQs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#it-takes-too-long-time-to-compile-a-computational-graph-can-i-skip-it">It takes too long time to compile a computational graph. Can I skip it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html#mnist-example-does-not-converge-in-cpu-mode-on-mac-os-x">mnist example does not converge in CPU mode on Mac OS X</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../comparison.html">Comparison with Other Frameworks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../comparison.html#a-table-for-quick-comparison">A table for quick comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../comparison.html#benchmarks">Benchmarks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../license.html#cupy">CuPy</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Chainer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Chainer Tutorial</a> &raquo;</li>
      
    <li>Type check</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/tutorial/type_check.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="type-check">
<h1>Type check<a class="headerlink" href="#type-check" title="Permalink to this headline">¶</a></h1>
<p>In this section, you will learn about the following things:</p>
<ul class="simple">
<li>Basic usage of type check</li>
<li>Detail of type information</li>
<li>Internal mechanism of type check</li>
<li>More complicated cases</li>
<li>Call functions</li>
<li>Typical type check example</li>
</ul>
<p>After reading this section, you will be able to:</p>
<ul class="simple">
<li>Write a code to check types of input arguments of your own functions</li>
</ul>
<div class="section" id="basic-usage-of-type-check">
<h2>Basic usage of type check<a class="headerlink" href="#basic-usage-of-type-check" title="Permalink to this headline">¶</a></h2>
<p>When you call a function with an invalid type of array, you sometimes receive no error, but get an unexpected result by broadcasting.
When you use CUDA with an illegal type of array, it causes memory corruption, and you get a serious error.
These bugs are hard to fix.
Chainer can check preconditions of each function, and helps to prevent such problems.
These conditions may help a user to understand specification of functions.</p>
<p>Each implementation of <a class="reference internal" href="../reference/core/function.html#chainer.Function" title="chainer.Function"><code class="xref py py-class docutils literal"><span class="pre">Function</span></code></a> has a method for type check, <code class="xref py py-meth docutils literal"><span class="pre">check_type_forward()</span></code>.
This function is called just before the <code class="xref py py-meth docutils literal"><span class="pre">forward()</span></code> method of the <a class="reference internal" href="../reference/core/function.html#chainer.Function" title="chainer.Function"><code class="xref py py-class docutils literal"><span class="pre">Function</span></code></a> class.
You can override this method to check the condition on types and shapes of arguments.</p>
<p><code class="xref py py-meth docutils literal"><span class="pre">check_type_forward()</span></code> gets an argument <code class="docutils literal"><span class="pre">in_types</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">check_type_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_types</span><span class="p">):</span>
  <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">in_types</span></code> is an instance of <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.TypeInfoTuple" title="chainer.utils.type_check.TypeInfoTuple"><code class="xref py py-class docutils literal"><span class="pre">TypeInfoTuple</span></code></a>, which is a sub-class of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">tuple</span></code></a>.
To get type information about the first argument, use <code class="docutils literal"><span class="pre">in_types[0]</span></code>.
If the function gets multiple arguments, we recommend to use new variables for readability:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x_type</span><span class="p">,</span> <span class="n">y_type</span> <span class="o">=</span> <span class="n">in_types</span>
</pre></div>
</div>
<p>In this case, <code class="docutils literal"><span class="pre">x_type</span></code> represents the type of the first argument, and <code class="docutils literal"><span class="pre">y_type</span></code> represents the second one.</p>
<p>We describe usage of <code class="docutils literal"><span class="pre">in_types</span></code> with an example.
When you want to check if the number of dimension of <code class="docutils literal"><span class="pre">x_type</span></code> equals to <code class="docutils literal"><span class="pre">2</span></code>, write this code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">x_type</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>When this condition is true, nothing happens.
Otherwise this code throws an exception, and the user gets a message like this:</p>
<div class="highlight-none"><div class="highlight"><pre>Traceback (most recent call last):
...
InvalidType: Expect: in_types[0].ndim == 2
Actual: 3 != 2
</pre></div>
</div>
<p>This error message means that &#8220;<code class="docutils literal"><span class="pre">ndim</span></code> of the first argument expected to be <code class="docutils literal"><span class="pre">2</span></code>, but actually it is <code class="docutils literal"><span class="pre">3</span></code>&#8221;.</p>
</div>
<div class="section" id="detail-of-type-information">
<h2>Detail of type information<a class="headerlink" href="#detail-of-type-information" title="Permalink to this headline">¶</a></h2>
<p>You can access three information of <code class="docutils literal"><span class="pre">x_type</span></code>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">.shape</span></code> is a tuple of ints. Each value is size of each dimension.</li>
<li><code class="docutils literal"><span class="pre">.ndim</span></code> is <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">int</span></code></a> value representing the number of dimensions. Note that <code class="docutils literal"><span class="pre">ndim</span> <span class="pre">==</span> <span class="pre">len(shape)</span></code></li>
<li><code class="docutils literal"><span class="pre">.dtype</span></code> is <code class="docutils literal"><span class="pre">numpy.dtype</span></code> representing data type of the value.</li>
</ul>
<p>You can check all members.
For example, the size of the first dimension must be positive, you can write like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also check data types with <code class="docutils literal"><span class="pre">.dtype</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">x_type</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</pre></div>
</div>
<p>And an error is like this:</p>
<div class="highlight-none"><div class="highlight"><pre>Traceback (most recent call last):
...
InvalidType: Expect: in_types[0].dtype == &lt;type &#39;numpy.float64&#39;&gt;
Actual: float32 != &lt;type &#39;numpy.float64&#39;&gt;
</pre></div>
</div>
<p>You can also check <code class="docutils literal"><span class="pre">kind</span></code> of <code class="docutils literal"><span class="pre">dtype</span></code>.
This code checks if the type is floating point</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">x_type</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can compare between variables.
For example, the following code checks if the first argument and the second argument have the same length:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">y_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="internal-mechanism-of-type-check">
<h2>Internal mechanism of type check<a class="headerlink" href="#internal-mechanism-of-type-check" title="Permalink to this headline">¶</a></h2>
<p>How does it show an error message like <code class="docutils literal"><span class="pre">&quot;in_types[0].ndim</span> <span class="pre">==</span> <span class="pre">2&quot;</span></code>?
If <code class="docutils literal"><span class="pre">x_type</span></code> is an object containing <code class="docutils literal"><span class="pre">ndim</span></code> member variable, we cannot show such an error message because this equation is evaluated as a boolean value by Python interpreter.</p>
<p>Actually <code class="docutils literal"><span class="pre">x_type</span></code> is a <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> objects, and doesn&#8217;t have a <code class="docutils literal"><span class="pre">ndim</span></code> member variable itself.
<a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> represents a syntax tree.
<code class="docutils literal"><span class="pre">x_type.ndim</span></code> makes a <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> object representing <code class="docutils literal"><span class="pre">(getattr,</span> <span class="pre">x_type,</span> <span class="pre">'ndim')</span></code>.
<code class="docutils literal"><span class="pre">x_type.ndim</span> <span class="pre">==</span> <span class="pre">2</span></code> makes an object like <code class="docutils literal"><span class="pre">(eq,</span> <span class="pre">(getattr,</span> <span class="pre">x_type,</span> <span class="pre">'ndim'),</span> <span class="pre">2)</span></code>.
<code class="xref py py-meth docutils literal"><span class="pre">type_check.expect()</span></code> gets a <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> object and evaluates it.
When it is <code class="docutils literal"><span class="pre">True</span></code>, it causes no error and shows nothing.
Otherwise, this method shows a readable error message.</p>
<p>If you want to evaluate a <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> object, call <code class="xref py py-meth docutils literal"><span class="pre">eval()</span></code> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">actual_type</span> <span class="o">=</span> <span class="n">x_type</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">actual_type</span></code> is an instance of <code class="xref py py-class docutils literal"><span class="pre">TypeInfo</span></code>, while <code class="docutils literal"><span class="pre">x_type</span></code> is an instance of <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a>.
In the same way, <code class="docutils literal"><span class="pre">x_type.shape[0].eval()</span></code> returns an int value.</p>
</div>
<div class="section" id="more-powerful-methods">
<h2>More powerful methods<a class="headerlink" href="#more-powerful-methods" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> class is more powerful.
It supports all mathematical operators such as <code class="docutils literal"><span class="pre">+</span></code> and <code class="docutils literal"><span class="pre">*</span></code>.
You can write a condition that the first dimension of <code class="docutils literal"><span class="pre">x_type</span></code> is the first dimension of <code class="docutils literal"><span class="pre">y_type</span></code> times four:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">y_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>When <code class="docutils literal"><span class="pre">x_type.shape[0]</span> <span class="pre">==</span> <span class="pre">3</span></code> and <code class="docutils literal"><span class="pre">y_type.shape[0]</span> <span class="pre">==</span> <span class="pre">1</span></code>, users can get the error message below:</p>
<div class="highlight-none"><div class="highlight"><pre>Traceback (most recent call last):
...
InvalidType: Expect: in_types[0].shape[0] == in_types[1].shape[0] * 4
Actual: 3 != 4
</pre></div>
</div>
<p>To compare a member variable of your function, wrap a value with <code class="xref py py-class docutils literal"><span class="pre">Variable</span></code> to show readable error message:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_size</span><span class="p">,</span> <span class="s">&quot;in_size&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This code can check the equivalent condition below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_size</span>
</pre></div>
</div>
<p>However, the latter condition doesn&#8217;t know the meaning of this value.
When this condition is not satisfied, the latter code shows unreadable error message:</p>
<div class="highlight-python"><div class="highlight"><pre>InvalidType: Expect: in_types[0].shape[0] == 4  # what does &#39;4&#39; mean?
Actual: 3 != 4
</pre></div>
</div>
<p>Note that the second argument of <code class="xref py py-class docutils literal"><span class="pre">utils.type_check.Variable</span></code> is only for readability.</p>
<p>The former shows this message:</p>
<div class="highlight-python"><div class="highlight"><pre>InvalidType: Expect: in_types[0].shape[0] == in_size  # OK, `in_size` is a value that is given to the constructor
Actual: 3 != 4  # You can also check actual value here
</pre></div>
</div>
</div>
<div class="section" id="call-functions">
<h2>Call functions<a class="headerlink" href="#call-functions" title="Permalink to this headline">¶</a></h2>
<p>How to check summation of all values of shape?
<a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> also supports function call:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">sum</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="s">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Why do we need to wrap the function <code class="docutils literal"><span class="pre">numpy.sum</span></code> with <code class="xref py py-class docutils literal"><span class="pre">utils.type_check.Variable</span></code>?
<code class="docutils literal"><span class="pre">x_type.shape</span></code> is not a tuple but an object of <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> as we have seen before.
Therefore, <code class="docutils literal"><span class="pre">numpy.sum(x_type.shape)</span></code> fails.
We need to evaluate this function lazily.</p>
<p>The above example produces an error message like this:</p>
<div class="highlight-none"><div class="highlight"><pre>Traceback (most recent call last):
...
InvalidType: Expect: sum(in_types[0].shape) == 10
Actual: 7 != 10
</pre></div>
</div>
</div>
<div class="section" id="more-complicated-cases">
<h2>More complicated cases<a class="headerlink" href="#more-complicated-cases" title="Permalink to this headline">¶</a></h2>
<p>How to write a more complicated condition that can&#8217;t be written with these operators?
You can evaluate <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> and get its result value with <code class="xref py py-meth docutils literal"><span class="pre">eval()</span></code> method.
Then check the condition and show warning message by hand:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x_shape</span> <span class="o">=</span> <span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c"># get actual shape (int tuple)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">more_complicated_condition</span><span class="p">(</span><span class="n">x_shape</span><span class="p">):</span>
    <span class="n">expect_msg</span> <span class="o">=</span> <span class="s">&#39;Shape is expected to be ...&#39;</span>
    <span class="n">actual_msg</span> <span class="o">=</span> <span class="s">&#39;Shape is ...&#39;</span>
    <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">InvalidType</span><span class="p">(</span><span class="n">expect_msg</span><span class="p">,</span> <span class="n">actual_msg</span><span class="p">)</span>
</pre></div>
</div>
<p>Please write a readable error message.
This code generates the following error message:</p>
<div class="highlight-none"><div class="highlight"><pre>Traceback (most recent call last):
...
InvalidType: Expect: Shape is expected to be ...
Actual: Shape is ...
</pre></div>
</div>
</div>
<div class="section" id="typical-type-check-example">
<h2>Typical type check example<a class="headerlink" href="#typical-type-check-example" title="Permalink to this headline">¶</a></h2>
<p>We show a typical type check for a function.</p>
<p>First check the number of arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">in_types</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">in_types.size()</span></code> returns a <a class="reference internal" href="../reference/check.html#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> object representing the number of arguments.
You can check it in the same way.</p>
<p>And then, get each type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x_type</span><span class="p">,</span> <span class="n">y_type</span> <span class="o">=</span> <span class="n">in_types</span>
</pre></div>
</div>
<p>Don&#8217;t get each value before checking <code class="docutils literal"><span class="pre">in_types.size()</span></code>.
When the number of argument is illegal, <code class="docutils literal"><span class="pre">type_check.expect</span></code> might output unuseful error messages.
For example, this code doesn&#8217;t work when the size of <code class="docutils literal"><span class="pre">in_types</span></code> is 0:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
  <span class="n">in_types</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>
  <span class="n">in_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>After that, check each type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">utils</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
  <span class="n">x_type</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
  <span class="n">x_type</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span>
  <span class="n">x_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The above example works correctly even when <code class="docutils literal"><span class="pre">x_type.ndim</span> <span class="pre">==</span> <span class="pre">0</span></code> as all conditions are evaluated lazily.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../reference/index.html" class="btn btn-neutral float-right" title="Chainer Reference Manual">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="function.html" class="btn btn-neutral" title="Define your own function"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Preferred Networks, inc. and Preferred Infrastructure, inc..
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.8.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>